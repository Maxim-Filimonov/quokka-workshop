/*! signet 19-07-2017 */

function signetParser(){"use strict";function a(a){if("string"!=typeof a)throw new Error("Macro Error: All macros must return a string; got "+a+" of type "+typeof a)}function b(b,c){for(var d=c,e=b.length,f=0;f<e;f++)d=b[f](d),a(d);return d}function c(a){t.push(a)}function d(a){u.push(a)}function e(a){var b=a.trim().split("<").slice(1).join("<");return b.substring(0,b.length-1)}function f(a){return";"===a||","===a}function g(a){var b=/^\[(.*)\]$/;return q(f,e(a.trim().replace(b,"$1"))).map(function(a){return a.trim()})}function h(a){var c=b(t,a),d=/^([^:<]+)\:(.+)$/,e=c.replace(d,"$1"),f=c.replace(d,"$2");return{name:e===c?null:e.trim(),type:f.split("<")[0].replace(/\[|\]/g,"").trim(),subtype:g(f),optional:null!==f.trim().match(/^\[[^\]]+\]$/)}}function i(a){var b=a.trim().split(/\s+/g);return{operator:b[1],left:b[0],right:b[2]}}function j(a){return a.split(/\,\s*/g).map(i)}function k(a){return","===a}function l(a){return"::"===a}function m(a){var b=q(l,a),c=b.length>1?b.shift():null,d=q(k,b[0]).map(h);return d.dependent=null===c?null:j(c),d}function n(){function a(a){"<"===a&&b.push("<"),">"===a&&b.pop(),"::"===a&&(b.length=0)}var b=[];return{update:a,get length(){return b.length}}}function o(a){return"="===a||"%"===a||":"===a}function p(a){return"%"===a[0]||"=>"===a||"::"===a}function q(a,b){for(var c=[],d="",e="",f=n(),g=0;g<b.length;g++)e=b[g],0!==f.length||"%"!==e?(o(e)&&p(e+b[g+1])&&(g++,e+=b[g]),f.update(e),a(e)&&0===f.length?(c.push(d),d=""):d+=e):(g++,d+=b[g]);return""!==d&&c.push(d),c}function r(a){return"=>"===a}function s(a){return q(r,b(u,a)).map(m)}var t=[],u=[];return{parseSignature:s,parseType:h,registerSignatureLevelMacro:d,registerTypeLevelMacro:c}}function signetDuckTypes(a,b,c,d){function e(b,c){var d=f(c);a.defineSubtypeOf("object")(b,j(d,c)),p[b]=i(d,c)}function f(a){return Object.keys(a).map(function(c){return[c,b(a[c])]})}function g(a,b){return"function"==typeof p[b]?p[b](a):a}function h(a,b){return"string"==typeof a[b]?a[b]:a[b].name}function i(a,b){var e=Object.keys(b),f=e.reduce(function(a,e){var f=b[e];return a[e]=q(f)?d(c(f)):f,a},{});return function(b){return"object"!=typeof b||null===b?[["badDuckTypeValue","object",b]]:a.reduce(function(a,c){var d=c[0],e=c[1],i=h(f,d);return e(b[d])||a.push([d,i,g(b[d],i)]),a},[])}}function j(a){return function(b){return!!r(b)&&a.reduce(function(a,c){var d=c[0],e=c[1];return a&&e(b[d])},!0)}}function k(a){return j(f(a),a)}function l(a){var b=p[a];if(void 0===b)throw new Error('No duck type "'+a+'" exists.');return function(a){return b(a)}}function m(a){var b=Object.keys(a).length,c=k(a);return function(a){return b===Object.keys(a).length&&c(a)}}function n(b,c){var d=f(c);a.defineSubtypeOf("object")(b,m(c)),p[b]=i(d,c)}function o(a){return"function"==typeof p[a]}var p={},q=b("string"),r=b("composite<not<null>, variant<object, function>>");return{buildDuckTypeErrorChecker:i,defineDuckType:e,defineExactDuckType:n,duckTypeFactory:k,exactDuckTypeFactory:m,isRegisteredDuckType:o,reportDuckTypeErrors:l}}function signetCoreTypes(a,b,c,d,e,f,g,h){"use strict";function i(a){return function(b,c){return!a(b,c)}}function j(a,b){function c(c){return a[c]!==b[c]}if(y(a)||y(b)||a===b)return a===b;var d=Object.keys(a);return!(d.length!==Object.keys(b).length)&&0===d.filter(c).length}function k(a,b){return 0===Object.keys(b).filter(function(c){return typeof a[c]==typeof b[c]}).length}function l(a,b){return!(Object.keys(a).length<Object.keys(b).length)&&k(a,b)}function m(a,b){return l(b,a)}function n(a,b){return Object.keys(a).length===Object.keys(b).length&&k(a,b)}function o(a,b,c,d){return p(a,c)===p(b,d)}function p(a,b){return r(b.subtype)(a)}function q(b){return r(a.parseType(b).subtype)}function r(a){return function(b){var d=a.filter(function(a){return c(a)(b)})[0];return"string"!=typeof d?null:d}}function s(a,b,c,d){var f=p(a,c),g=p(b,d);return e(g)(f)}function t(a,b,c,d){return s(b,a,d,c)}function u(a,b){return a>b}function v(a,b){return a<b}function w(a,b){return a===b}function x(a){return function(b){return typeof b===a}}function y(a){return null===a}function z(a,b){if(0===b.length||"*"===b[0])return!0;var d=c(b[0]);return a.filter(d).length===a.length}function A(a,b){return"[object Array]"===Object.prototype.toString.call(a)&&z(a,b)}function B(a){return Math.floor(a)===a&&a!==1/0}function C(a,b){return b.min<=a&&a<=b.max}function D(a){return{min:Number(a[0]),max:Number(a[1])}}function E(a,b){return b.min<=a.length&&a.length<=b.max}function F(a){return 1===a.length?a[0]:a.join(";")}function G(a,b){return null!==a.match(b)}function H(a){return a.map(c)}function I(a){return a.join(", ")}function J(a){return!y(a)}function K(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function L(a,b){var c=a===b?1:0;return e(a)(b)?-1:c}function M(a,b){var c=0,d=0;for(c;c<a.length&&0===(d=L(a[c],b));c++);return a.splice(c+d,0,b),a}function N(a){return a.reduce(M,[])}function O(a){var b=a.slice(0);return function(a){for(var d=!1,e=c(a),f=0;f<b.length;f++)if(e(b[f])){d=!0,b.splice(f,1);break}return!d}}function P(a,b){return 0===b.filter(O(a)).length}function Q(a,b){return a.length===b.length&&P(a,N(b))}function R(a,b){function c(b,c,d){return b&&c(a[d])}return a.length===b.length&&b.reduce(c,!0)}function S(a,b){function c(b){return b(a)}return 0===b.length||b.filter(c).length>0}function T(a,b){return console.warn("Tagged Union is deprecated, use variant instead."),S(a,b)}function U(a,b){return b.reduce(function(b,c){return b&&c(a)},!0)}function V(a,b){return!b[0](a)}function W(b){return"function"==typeof b||d(a.parseType(b).type)}function X(a,b){return a.length===b.length}function Y(a,b){return a.length>b.length}function Z(a,b){return a.length<b.length}function $(a){return new RegExp("^([^\\:]+\\:)?(\\[)?{{typePattern}}(\\])?$".replace("{{typePattern}}",a))}function _(a,b,c){return b.test(a)?a.replace(b,c):a}return a.registerTypeLevelMacro(function(a){return/^\(\s*\)$/.test(a.trim())?"*":a}),a.registerTypeLevelMacro(function(a){var b=$("(\\!\\*)");return _(a.trim(),b,"$1$2not<variant<undefined, null>>$4")}),a.registerTypeLevelMacro(function(a){var b=$("\\?([^\\]]*)");return _(a.trim(),b,"$1$2variant<undefined, null, $3>$4")}),a.registerTypeLevelMacro(function(a){var b=$("\\^([^\\]]*)");return _(a.trim(),b,"$1$2not<$3>$4")}),a.registerSignatureLevelMacro(function(a){var b=/(\()((.*\=\>)+(.*))(\))/;return b.test(a)?a.replace(b,"function<$2>"):a}),b("boolean{0}",x("boolean")),b("function{0,1}",x("function"),I),b("number{0}",x("number")),b("object{0}",x("object")),b("string{0}",x("string")),b("symbol{0}",x("symbol")),b("undefined{0}",x("undefined")),b("not{1}",V,H),b("null{0}",y),b("variant{1,}",S,H),b("taggedUnion{1,}",T,H),b("composite{1,}",U,H),f("object")("array{0,}",A),f("object")("regexp{0}",K),f("number")("int{0}",B),f("number")("bounded{2}",C,D),f("string")("boundedString{2}",E,D),f("string")("formattedString{1}",G,F),f("array")("tuple{1,}",R,H),f("array")("unorderedProduct{1,}",Q),f("object")("arguments{0}",J),g("typeValue{0}","variant<string, function>"),f("typeValue")("type{0}",W),g("any{0}","*"),g("void{0}","*"),g("leftBounded{1}","bounded<_, Infinity>"),g("rightBounded{1}","bounded<-Infinity, _>"),g("boundedInt{2}","composite<int, bounded<_, _>>"),g("leftBoundedInt{1}","boundedInt<_, Infinity>"),g("rightBoundedInt{1}","boundedInt<-Infinity, _>"),h("number")(">",u),h("number")("<",v),h("number")("=",w),h("number")(">=",i(v)),h("number")("<=",i(u)),h("number")("!=",i(w)),h("string")("=",w),h("string")("!=",i(w)),h("string")("#=",X),h("string")("#<",Z),h("string")("#>",Y),h("array")("#=",X),h("array")("#<",Z),h("array")("#>",Y),h("object")("=",j),h("object")("!=",i(j)),h("object")(":>",l),h("object")(":<",m),h("object")(":=",n),h("object")(":!=",i(n)),h("variant")("isTypeOf",o),h("variant")("=:",o),h("variant")("<:",s),h("variant")(">:",t),{whichType:r,whichVariantType:q}}function signetBuilder(a,b,c,d,e,f,g,h){"use strict";function i(a){return O.test(a)}function j(a,b){return b.reduce(function(a,b){return a.replace(O,"$1"+b+"$3")},a)}function k(b){var c=a.isTypeOf(b);return function(a){return c(a)}}function l(a){return function(b,c){var e=j(a,c);return k(d.parseType(e))(b)}}function m(a,b){var c=d.parseType(b);M(a,i(b)?l(b):k(c))}function n(b){return"string"==typeof b?a.isTypeOf(d.parseType(b)):b}function o(a,b,c){return Object.defineProperty(a,b,{value:c,writeable:!1}),a}function p(a,b){return o(a,"signatureTree",b),Object.defineProperty(a,"signature",{writeable:!1,get:function(){return e.assembleSignature(a.signatureTree)}}),a}function q(a,b){var d=c.checkSignature(a),f=a.length-1;if(a.length<2)throw new SyntaxError("Signature must have both input and output types");if(a[0].length<b.length)throw new Error("Signature declaration too short for function with "+b.length+" arguments.");if(a[f].length>1)throw new SyntaxError("Signature can only have a single output type");if(null!==d){var g=d.map(e.assembleType);throw new TypeError("Signature contains invalid types: "+g.join(", "))}}function r(a,b){return p(b,a),o(b,"signatureTree",a)}function s(a,b){var c=d.parseSignature(a);return q(c,b),r(c,b)}function t(a){return a[a.length-1]}function u(a,b,c){var d=a[0],e=a[1],f=typeof e;return c+" expected a "+b+"value of type "+d+" but got "+a[1]+" of type "+f}function v(a){return function(b,c,d,e,f){var g=u(b,a,f);throw"function"==typeof c&&(g=c(b,d,e,f)),new TypeError(g)}}function w(a,b,c,d){return u(a,"",d)}function x(a,b,c,d){return u(a,"return ",d)}function y(a,c){var d=b.validateArguments(a.signatureTree[0])(c);null!==d&&Q(d,null,c,a.signatureTree,z(a))}function z(a){return""===a.name?"Anonymous":a.name}function A(a,c,d){var f=z(c);return function(){var g=Array.prototype.slice.call(arguments,0),h=b.validateArguments(a[0])(g);null!==h&&Q(h,d.inputErrorBuilder,g,a,f);var i=a.length>2,j=i?P:t(a)[0],k=e.assembleType(j),l=c.apply(this,g);return b.validateType(j)(l)||R([k,l],d.outputErrorBuilder,g,a,f),i?C(a.slice(1),l,d):l}}function B(a){return function(){var b=Array.prototype.slice.call(arguments,0);return a.apply(this,b)}}function C(a,b,c){var d=A(a,b,c),e=B(d);return e.toString=Function.prototype.toString.bind(b),r(a,e)}function D(b){return b.typeCheck=a.isTypeOf(b),b}function E(a){var b=a.map(D);return b.dependent=a.dependent,b}function F(a){return a.map(E)}function G(a,b,c){return C(F(d.parseSignature(a)),b,"object"==typeof c&&null!==c?c:{})}function H(a,b){"function"==typeof b&&(a.preprocess=b)}function I(a,b){var c=b.replace(S,"$2"),d=c.split(/\,\s*/g),e=0,f=1/0;if(c!==b){if(e=parseInt(d[0]),f=1===d.length?e:parseInt(d[1]),e>f)throw new Error("Error in "+a+" arity declaration: min cannot be greater than max");e=isNaN(e)||e<0?0:e,f=isNaN(f)||f<0?1/0:f}return[e,f]}function J(a){return a.replace(S,"$1").trim()}function K(a,b,c){var d="[object Array]"===Object.prototype.toString.call(c),e=null;if(d&&c.length<b[0]?e="Type "+a+" requires, at least, "+b[0]+" arguments":d&&c.length>b[1]&&(e="Type "+a+" accepts, at most, "+b[1]+" arguments"),null!==e)throw new Error(e)}function L(a,b,c){return function(d,e){return K(a,b,e),c(d,e)}}function M(b,c,d){var e=J(b),f=I(e,b),g=L(e,f,c);H(g,d),a.define(e,g)}function N(b){var c=a.defineSubtypeOf(b);return function(a,b,d){var e=J(a),f=I(e,a),g=L(e,f,b);H(g,d),c(e,g)}}var O=/([<\;\,]\s*)(_)(\s*[>\;\,])/,P=d.parseType("function"),Q=v(""),R=v("return "),S=/^([^\{]+)\{([^\}]+)\}$/,T=g(d,M,n,a.isType,a.isSubtypeOf,N,m,a.defineDependentOperatorOn),U=f(a,n,d.parseType,e.assembleType),V=h(M,n);return{alias:G("aliasName != typeString :: aliasName:string, typeString:string => undefined",m),buildInputErrorMessage:G("validationResult:tuple<expectedType:type, actualValue:*>, args:array<*>, signatureTree:array<array<object>>, functionName:string => string",w),buildOutputErrorMessage:G("validationResult:tuple<expectedType:type, actualValue:*>, args:array<*>, signatureTree:array<array<object>>, functionName:string => string",x),duckTypeFactory:G("duckTypeDef:object => function",U.duckTypeFactory),defineDuckType:G("typeName:string, duckTypeDef:object => undefined",U.defineDuckType),defineExactDuckType:G("typeName:string, duckTypeDef:object => undefined",U.defineExactDuckType),defineDependentOperatorOn:G("typeName:string => operator:string, operatorCheck:function<valueA:*, valueB:*, typeDefinitionA:[object], typeDefinitionB:[object] => boolean> => undefined",a.defineDependentOperatorOn),defineRecursiveType:G("typeName:string, iteratorFactory:function, nodeType:type, typePreprocessor:[function] => undefined",V.defineRecursiveType),enforce:G("signature:string, functionToEnforce:function, options:[object] => function",G),exactDuckTypeFactory:G("duckTypeDef:object => function",U.exactDuckTypeFactory),extend:G("typeName:string, typeCheck:function, preprocessor:[function<string => string>] => undefined",M),isRegisteredDuckType:G("typeName:string => boolean",U.isRegisteredDuckType),isSubtypeOf:G("rootTypeName:string => typeNameUnderTest:string => boolean",a.isSubtypeOf),isType:G("typeName:string => boolean",a.isType),isTypeOf:G("typeToCheck:type => value:* => boolean",n),iterateOn:G("propertyKey:string => value:* => undefined => *",V.iterateOn),iterateOnArray:G("iterationArray:array => undefined => *",V.iterateOnArray),recursiveTypeFactory:G("iteratorFactory:function, nodeType:type => valueToCheck:* => boolean",V.recursiveTypeFactory),registerTypeLevelMacro:G("macro:function => undefined",d.registerTypeLevelMacro),reportDuckTypeErrors:G("duckTypeName:string => valueToCheck:* => array<tuple<string, string, *>>",U.reportDuckTypeErrors),sign:G("signature:string, functionToSign:function => function",s),subtype:G("rootTypeName:string => subtypeName:string, subtypeCheck:function, preprocessor:[function<string => string>] => undefined",N),typeChain:G("typeName:string => string",a.getTypeChain),verify:G("signedFunctionToVerify:function, functionArguments:arguments => undefined",y),whichType:G("typeNames:array<string> => value:* => variant<string, null>",T.whichType),whichVariantType:G("variantString:string => value:* => variant<string, null>",T.whichVariantType)}}var signetAssembler=function(){"use strict";function a(a){return a.subtype&&a.subtype.length>0}function b(b){return a(b)?"<"+b.subtype.join(";")+">":""}function c(a,b){return"string"==typeof a?a+":"+b:b}function d(a,b){return b?"["+a+"]":a}function e(a){return d(a.type+b(a),a.optional)}function f(a){var b=e(a);return c(a.name,b)}function g(a,b){return(""!==a?a+", ":a)+[b.left,b.operator,b.right].join(" ")}function h(a){return a.reduce(g,"")+" :: "}function i(a){var b=a.map(f).join(", ");return(null===a.dependent?"":h(a.dependent))+b}function j(a){return a.map(i).join(" => ")}return{assembleSignature:j,assembleType:f}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetAssembler);var signetChecker=function(){"use strict";return function(a){function b(b){try{return"function"==typeof a.get(b.type)}catch(a){return!1}}function c(a,b){return a.concat(b)}function d(a){return function(b){return!a(b)}}function e(a){var e=a.reduce(c,[]).filter(d(b));return e.length>0?e:null}return{checkSignature:e,checkType:b}}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetChecker),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetParser);var signetRegistrar=function(){"use strict";return function(){function a(a,b){return typeof b===a}function b(b){return a("string",b)&&null!==b.match(/^[^\(\)\<\>\[\]\:\;\=\,\s]+$/)}function c(c,d){if(!b(c))throw new Error("Invalid type name: "+c);if(!a("undefined",f[c]))throw new Error("Type already registered with name "+c);if(!a("function",d))throw new Error("Type predicate parameter must be a function")}function d(a){var b=f[a];if(void 0===b)throw new Error('The given type "'+a+'" does not exist');return b}function e(a,b){c(a,b),f[a]=b}var f={};return{get:d,set:e}}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetRegistrar);var signetTypelog=function(a,b){"use strict";function c(a){return function(b){return a.optional&&void 0===b}}function d(b){var d=c(b);return function(c){return a.get(b.type)(c,b.subtype)||d(c)}}function e(a,b,c){Object.defineProperty(a,b,{value:c,writeable:!1})}function f(b){return function(c,d){e(d,"parentTypeName",b),a.set(c,d)}}function g(b){try{return"function"==typeof a.get(b)}catch(a){return!1}}function h(b){return function(c){var d=a.get(c).parentTypeName,e=void 0===d,f=d===b;return e||f?f:h(b)(d)}}function i(b){var c=k(b);return function(d){var e=a.get(b.type),f=e.parentTypeName;return!(void 0!==f)||l(c,f,d)}}function j(a){return a}function k(b){var c=a.get(b.type),d="function"==typeof c.preprocess?c.preprocess:j;return{name:b.name,type:b.type,subtype:d(b.subtype),originalSubtype:b.subtype,optional:b.optional}}function l(a,c,e){var f=b.parseType(c);return f.subtype.concat(a.originalSubtype),i(f)(e)&&d(a)(e)}function m(b){var c=a.get(b);return void 0!==c.parentTypeName?m(c.parentTypeName)+" -> "+b:b}function n(b){var c=a.get(b);return function(a,b){e(c,a,{operator:a,operation:b})}}function o(b){return function(c){var d=a.get(b);return"object"==typeof d[c]?d[c]:"*"==b?null:o(d.parentTypeName)(c)}}return a.set("*",function(){return!0}),{define:f("*"),defineDependentOperatorOn:n,defineSubtypeOf:f,getDependentOperatorOn:o,getTypeChain:m,isType:g,isTypeOf:i,isSubtypeOf:h}};"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetTypelog);var signetValidator=function(){"use strict";function a(a){return a[0]}function b(a){return a.slice(1)}return function(c,d,e){function f(a,b,c){return a.optional&&(c.length>1||void 0===b)}function g(a){return"function"==typeof a.typeCheck?a.typeCheck:c.isTypeOf(a)}function h(c,e){var h=a(c),i=a(e),j=g(h)(i),k=j?b(e):e,l=r(b(c));return j||f(h,i,c)?l(k):[d.assembleType(h),i]}function i(a,b,c){var d=null;if(!c.operation(a.value,b.value,a.typeNode,b.typeNode)){d=[[a.name,c.operator,b.name].join(" "),[a.name,"=",a.value,"and",b.name,"=",b.value].join(" ")]}return d}function j(){return!1}function k(a,b){var d=c.getDependentOperatorOn(a)(b);return null===d&&(d={operator:b,operation:j}),d}function l(a){function b(a){return f(a)}var d=e.parseType(a),f=c.isTypeOf(d);return b.toString=function(){return"[function typePredicate]"},{name:a,value:b,typeNode:d}}function m(a){return{name:a,value:a,typeNode:{}}}function n(a,b){var d=a[b];return void 0===d&&(d=c.isType(b)?l(b):m(b)),d}function o(a){return function(b,c){var d=null;if(null===c){var e=a[b.left];d=i(e,n(a,b.right),k(e.typeNode.type,b.operator))}return null===d?c:d}}function p(a,b){for(var c,d,e={},f=a.length,g=0;g<f;g++)c=a[g],d=c.name,e[d]={name:d,value:b[g],typeNode:a[g]};return e}function q(a){return"[object Array]"===Object.prototype.toString.call(a)?a:[]}function r(a){var b=q(a.dependent);return function(c){var d=p(a,c),e=0===a.length?null:h(a,c),f=o(d);return b.forEach(function(a){e=f(a,e)}),e}}return{validateArguments:r,validateType:g}}}();"undefined"!=typeof module&&void 0!==typeof module.exports&&(module.exports=signetValidator),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetDuckTypes),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetCoreTypes),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetBuilder);var signet=function(){"use strict";function a(){var a=signetAssembler,b=signetParser(),c=signetRegistrar(),d=signetChecker(c),e=signetTypelog(c,b);return signetBuilder(e,signetValidator(e,a),d,b,a,signetDuckTypes,signetCoreTypes)}return"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=a),a()}();
//# sourceMappingURL=signet.min.js.map